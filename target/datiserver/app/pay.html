<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
		<title></title>
		<script src="js/jquery1.10.2.min.js"></script>
		<script src="js/util.js"></script>
		<script src="http://res.wx.qq.com/open/js/jweixin-1.1.0.js"></script>
		<script src="js/init.js"></script>
	</head>

	<body>
		<span id="tip"></span>
		<button id="payBtn">支付</button>
	</body>

	<script type="text/javascript">
	
		function startLoginGame(authKey){
			
			//调用egret工程，进行websocket连接
			
		}
	
		function getlogininfo(openid, access_token) {
			$.ajax({
				type: 'get',
				url: 'http://172.26.38.21:7088/login/wxgetUser',
				data: {
					openid: openid,
					access_token: access_token
				},
				dataType: 'json',
				async: false,
				cache: false,
				success: function(result) {
					alert( JSON.stringify(result));
					//$("#tip").html("hello " + result.nickname);
					startLoginGame(result.authKey);
				}
			});
		}

		function initWxSdk(useHtml) {
			$.ajax({
				type: 'get',
				url: 'http://172.26.38.21:7088/login/wxJsApiTicket',
				data: {
					useHtml: useHtml
				},
				dataType: 'json',
				async: false,
				cache: false,
				success: function(result) {

					wx.config({
						debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
						appId: result.appId, // 必填，公众号的唯一标识
						timestamp: result.timestamp, // 必填，生成签名的时间戳
						nonceStr: result.nonceStr, // 必填，生成签名的随机串
						signature: result.signature, // 必填，签名，见附录1
						jsApiList: ["onMenuShareAppMessage", "chooseWXPay"] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
					});

					wx.ready(function() {

						wx.onMenuShareAppMessage({
							title: '小宝', // 分享标题
							desc: '爆料', // 分享描述
							link: 'http://172.26.38.21/BUPlatform_board/index.html', // 分享链接
							imgUrl: '', // 分享图标
							type: '', // 分享类型,music、video或link，不填默认为link
							dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
							success: function() {
								// 用户确认分享后执行的回调函数
							},
							cancel: function() {
								// 用户取消分享后执行的回调函数
							}
						});

					});
				}
			});
		}

		var openid = GetQueryString("openid");
		var access_token = GetQueryString("access_token");
		getlogininfo(openid, access_token);
		//initWxSdk(window.location.href);

		$("#payBtn").click(function(){
			$("#tip").html("支付中...");
			$.ajax({
				type: 'get',
				url: 'http://172.26.38.21:7088/pay/wxPayRequest',
				data: {
					openid: openid,
					access_token: access_token
				},
				dataType: 'json',
				async: false,
				cache: false,
				success: function(result) {
					alert( JSON.stringify(result));
					$("#tip").html("支付失败");
				}
			});
		});
	</script>

</html>